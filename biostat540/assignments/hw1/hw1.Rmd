---
title: "BIOST540HW1"
author: "Bryan Ng, 2427348"
date: "2025-04-17"
output: pdf_document
---

```{r, warning = FALSE}
library(tidyverse)
library(reshape2)
```

\section{Problem 1}

```{r}
aug <- read.csv("C:/Users/ncwbr/Desktop/augmentation.csv")
aug <- aug[, c("id", "Treatment_Group", "HD_t0", "HD_t1", "HD_t2",
"HD_t3", "HD_t4", "HD_t5", "HD_t6")]
aug_long <- melt(aug, id=c("id","Treatment_Group"))
aug_long$week <- as.numeric(gsub("HD_t","",aug_long$variable))
```

\subsection{(a)}

We summarized the distribution of HDRS scores at baseline and weeks 1–6 in both groups by computing the mean, standard deviation, and median.

```{r, warning = FALSE}
hdrs_summary <- aug_long %>%
  group_by(Treatment_Group, week) %>%
  summarise(
    mean_HDRS = mean(value, na.rm=TRUE),
    sd_HDRS = sd(value,   na.rm=TRUE),
    median_HDRS = median(value, na.rm=TRUE),
    n = sum(!is.na(value))
  )
hdrs_summary

hdrs_summary %>%
  mutate(se = sd_HDRS / sqrt(n)) %>%
  ggplot(aes(x = week, y = mean_HDRS, color = Treatment_Group)) +
  geom_line(linewidth = 1) +
  geom_point() +
  geom_ribbon(aes(ymin = mean_HDRS - se, ymax = mean_HDRS + se,
                  fill = Treatment_Group),
              alpha = 0.2, colour = NA) +
  labs(
    x = "Week",
    y = "Mean HDRS score",
    title = "Mean HDRS over time by Treatment Group"
  ) +
  theme_minimal()
```

We observed a decreasing trend in HDRS scores over time in both the augmentation and control groups, with the control group’s mean slightly higher than that of the augmentation group.

\subsection{(b)}

```{r, warning = FALSE}
aug_long %>%
  ggplot(aes(x = week, y = value, group = id, color = Treatment_Group)) +
  geom_line(alpha = 0.5) +
  facet_wrap(~ Treatment_Group) +
  labs(
    x = "Week",
    y = "HDRS score",
    title = "Individual HDRS trajectories by Treatment Group"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

In the augmentation group, the lines become tighter than those in the control group over time, indicating substantially less variability in HDRS scores among augmentation group.

\subsection{(c)}

```{r, warning = FALSE}
hdrs_wide <- aug_long %>%
  select(id, Treatment_Group, week, value) %>%
  pivot_wider(names_from = week, values_from = value, names_prefix = "W")

cor_overall <- hdrs_wide %>%
  select(starts_with("W")) %>%
  cor(use = "pairwise.complete.obs")
print(cor_overall)
```

```{r}
cor_by_group <- hdrs_wide %>%
  group_by(Treatment_Group) %>%
  summarise(
    cor_mat = list(
      cor(
        across(starts_with("W")), 
        use = "pairwise.complete.obs"
      )
    ),
    .groups = "drop"
  )
cor_by_group$cor_mat
```

We found that the correlation between baseline and week $t$ decreases over time($\rho_{05} = 0.099$, $\rho_{06} = 0.06$), correlations between follow‑up weeks remain relatively high overall and within the augmentation group, while the control group’s correlations show less variability over time.

\subsection{Problem 2}

```{r}
tlc <- read.csv("C:/Users/ncwbr/Desktop/tlc.csv")
```

\subsection{(a)}

```{r}
tlc_long <- tlc %>%
  pivot_longer(
    cols = starts_with("y"), 
    names_to = "week", 
    names_prefix = "y",
    values_to = "lead_level"
  ) %>%
  mutate(
    week = as.numeric(week)
  )

ggplot(tlc_long, aes(x = week, y = lead_level, group = id, color = tx)) +
  geom_line(alpha = 0.4) +
  facet_wrap(~ tx) +
  scale_x_continuous(breaks = c(0,1,4,6)) +
  labs(
    x = "Week since baseline",
    y = "Blood lead level (µg/dL)",
    title = "Individual trajectories of blood lead over time",
    color = "Treatment\nGroup"
  ) +
  theme_minimal()
```

\subsection{(b)}

```{r}
lead_wide <- tlc %>% select(id, tx, y0, y1, y4, y6)

cor_overall <- cor(lead_wide %>% select(-id, -tx), 
                   use = "pairwise.complete.obs")
print(cor_overall)

cor_by_tx <- lead_wide %>%
  group_by(tx) %>%
  summarise(
    cor_mat = list(
      cor(across(y0:y6), use = "pairwise.complete.obs")
    )
  )

cor_by_tx$cor_mat
```

\subsection{(c)}

```{r}
tlc$tx <- factor(tlc$tx, levels = c("P", "A"))
mod_w6 <- lm(y6 ~ tx, data = tlc)
summary(mod_w6)
```

Using a linear model at the six‑week time point, we estimated the difference in week 6 blood lead levels between group A (succimer) and group P (placebo) as txA = -2.884, the standard deviation is 1.532 and p-value is equal to 0.0627. At significance level $\alpha = 0.05$, we can conclude that treatment does not have a significant effect on the Week 6 lead levels.

\subsection{(d)}

```{r}
mod_d <- lm(y6 - y0 ~ tx, data = tlc)
sum_d <- summary(mod_d)$coefficients
sum_d
```

The estimated difference txA = -3.152 with the standard deviation is equal to 1.257, the p-value is 0.013, which is less than $\alpha = 0.05$, indicating a significant treatment effect on week 6 lead levels.

\subsection{(e)}

```{r}
mod_e <- lm(y6 ~ tx + y0, data = tlc)
sum_e <- summary(mod_e)$coefficients
sum_e
```

Applying an ANCOVA model, we derive that he estimated difference txA = -3.120 with the standard deviation is equal to 1.258, the p-value is 0.0148, since p-value is less than 0.05, the treatment effect on week 6 lead levels is significant.

\subsection{(f)}

```{r}
se_c <- summary(mod_w6)$coefficients["txA", "Std. Error"]  
se_d <- sum_d   ["txA", "Std. Error"]
se_e <- sum_e   ["txA", "Std. Error"]

se_df <- tibble(
  model = c("Unadjusted y6 (c)", "Change Delta (d)", "ANCOVA (e)"),
  se    = c(se_c, se_d, se_e)
)

ggplot(se_df, aes(x = model, y = se)) +
  geom_col(fill = "steelblue", alpha = 0.7) +
  labs(
    x = "Model",
    y = "Std. Error of Treatment Effect",
    title = "Comparison of SEs: unadjusted vs change‐score vs ANCOVA"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 25, hjust = 1))
```

Adjusting for baseline—whether via change scores or ANCOVA—accounts for baseline variability in the residual error and thus reduces the standard error of the treatment effect.
